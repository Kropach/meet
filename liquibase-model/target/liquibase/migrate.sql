-- *********************************************************************
-- Update Database Script
-- *********************************************************************
-- Change Log: src/main/resources/db/changelog/db.changelog-master.xml
-- Ran at: 17.08.21 10:09
-- Against: manager@jdbc:postgresql://localhost:5432/academy
-- Liquibase version: 3.8.9
-- *********************************************************************

-- Create Database Lock Table
CREATE TABLE databasechangeloglock (ID INTEGER NOT NULL, LOCKED BOOLEAN NOT NULL, LOCKGRANTED TIMESTAMP WITHOUT TIME ZONE, LOCKEDBY VARCHAR(255), CONSTRAINT DATABASECHANGELOGLOCK_PKEY PRIMARY KEY (ID));

-- Initialize Database Lock Table
DELETE FROM databasechangeloglock;

INSERT INTO databasechangeloglock (ID, LOCKED) VALUES (1, FALSE);

-- Lock Database
UPDATE databasechangeloglock SET LOCKED = TRUE, LOCKEDBY = '5CD0535MXP (172.16.137.7)', LOCKGRANTED = '2021-08-17 10:09:09.659' WHERE ID = 1 AND LOCKED = FALSE;

-- Create Database Change Log Table
CREATE TABLE databasechangelog (ID VARCHAR(255) NOT NULL, AUTHOR VARCHAR(255) NOT NULL, FILENAME VARCHAR(255) NOT NULL, DATEEXECUTED TIMESTAMP WITHOUT TIME ZONE NOT NULL, ORDEREXECUTED INTEGER NOT NULL, EXECTYPE VARCHAR(10) NOT NULL, MD5SUM VARCHAR(35), DESCRIPTION VARCHAR(255), COMMENTS VARCHAR(255), TAG VARCHAR(255), LIQUIBASE VARCHAR(20), CONTEXTS VARCHAR(255), LABELS VARCHAR(255), DEPLOYMENT_ID VARCHAR(10));

-- Changeset src/main/resources/db/changelog/db.changelog-master.xml::creating department table::manager
CREATE TABLE department (department_id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, name VARCHAR, code INTEGER, CONSTRAINT department_pk PRIMARY KEY (department_id));

INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES ('creating department table', 'manager', 'src/main/resources/db/changelog/db.changelog-master.xml', NOW(), 1, '8:bf7c870965d1a8ee6d4f0d9be1c4f951', 'createTable tableName=department', '', 'EXECUTED', NULL, NULL, '3.8.9', '9184150484');

-- Changeset src/main/resources/db/changelog/db.changelog-master.xml::creating class table::manager
CREATE TABLE class (class_id INTEGER NOT NULL, name VARCHAR, duration INTEGER, department_id INTEGER NOT NULL, CONSTRAINT class_pk PRIMARY KEY (class_id), CONSTRAINT fk_department_id FOREIGN KEY (department_id) REFERENCES department(department_id));

INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES ('creating class table', 'manager', 'src/main/resources/db/changelog/db.changelog-master.xml', NOW(), 2, '8:c28127255e54e771e7080ab2521650be', 'createTable tableName=class', '', 'EXECUTED', NULL, NULL, '3.8.9', '9184150484');

-- Changeset src/main/resources/db/changelog/db.changelog-master.xml::creating student table::manager
CREATE TABLE student (student_id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, first_name VARCHAR, last_name VARCHAR, gender CHAR, email VARCHAR, dob date, CONSTRAINT student_pk PRIMARY KEY (student_id));

INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES ('creating student table', 'manager', 'src/main/resources/db/changelog/db.changelog-master.xml', NOW(), 3, '8:07a1a369a2827aef71d30dfd96695e86', 'createTable tableName=student', '', 'EXECUTED', NULL, NULL, '3.8.9', '9184150484');

-- Changeset src/main/resources/db/changelog/db.changelog-master.xml::creating index os student table::manager
CREATE INDEX index_first_name ON student(first_name);

INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES ('creating index os student table', 'manager', 'src/main/resources/db/changelog/db.changelog-master.xml', NOW(), 4, '8:88d949cb40afc0596286bc7728e7073b', 'createIndex indexName=index_first_name, tableName=student', '', 'EXECUTED', NULL, NULL, '3.8.9', '9184150484');

-- Release Database Lock
UPDATE databasechangeloglock SET LOCKED = FALSE, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1;

